@import url('https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&display=swap');

:root{
  --maxw: 1080px;
  --serif: 'Source Serif 4', 'Times New Roman', Times, serif;
  --lh: 1.7;
  --fs: 17px;

  /* semantic hues */
  --theorem: #2f5da9;
  --lemma:   #5b6b7f;
  --cor:     #b13b3b;
  --def:     #2f8f6b;
  --rem:     #5b6b7f;

  --ink: #0b1220;
  --muted: #4b5563;
  --rule: #e5e7eb;
  --soft: #f8fafc;

  --radius: 3px;
  --header-h: 70px;
}

html,body{height:100%}
body{
  margin:0; color:var(--ink); background:#fff;
  font-family:var(--serif); font-size:var(--fs); line-height:var(--lh);
  counter-reset: sec app 0;
}
a{color:var(--theorem); text-decoration:none}
a:hover{text-decoration:underline}
img{max-width:100%; display:block}
mjx-container[display="true"]{margin:12px 0 !important}

/* Sticky header + scroll snap compensation */
.section-title, theorem, lemma, corollary, proposition, definition, remark, equation, figure, table { scroll-margin-top: calc(var(--header-h) + 8px); }

.site-header{
  position: sticky; top: 0; z-index: 40; border-bottom:1px solid var(--rule);
  background:#fff linear-gradient(90deg, rgba(47,93,169,.12), rgba(177,59,59,.12));
}
.header-inner{
  max-width:var(--maxw); margin:0 auto; padding:12px 20px;
  min-height: var(--header-h); display:flex; align-items:center; justify-content:space-between
}
.brand{font-weight:700; letter-spacing:.2px}
.brand small{color:var(--muted); font-weight:600; margin-left:.5rem}

main{max-width:var(--maxw); margin:0 auto; padding: calc(var(--header-h) + 12px) 20px 28px;}

h1.title{font-weight:700; font-size:32px; line-height:1.25; margin:0 0 8px}
.authors{color:var(--muted); margin-bottom:16px}

.abstract,.callout{
  position:relative; padding:14px 16px; border:1px solid var(--rule);
  border-radius: var(--radius); background: var(--soft); margin:18px 0
}
.abstract .label{display:inline-block; font-style:italic; font-weight:700; color:var(--muted); margin-bottom:6px}
.abstract p,.callout p{margin:8px 0}

/* ---------------- Sections & Appendix counters ---------------- */
section.sec{counter-reset: subsec thm def rem eq fig tab}
section.appendix{counter-reset: subsec thm def rem eq fig tab}

section.sec > .section-title{
  font-size:24px; font-weight:700; margin:32px 0 12px; color: var(--ink);
  counter-increment: sec; /* keep eq numbering tied to section even if JS labels text */
}
/* Fallback numbering (no-JS): insert number text via ::before */
section.sec > .section-title:not([data-labeled])::before{
  content: counter(sec) ". "; font-weight:700; margin-right:2px; color: var(--ink)
}
/* Appendix heading increments a separate counter */
section.appendix > .section-title{ counter-increment: app; }
section.appendix > .section-title:not([data-labeled])::before{
  content: "Appendix " counter(app, upper-alpha) ". "; font-weight:700; margin-right:2px; color: var(--ink)
}

section.subsec > .section-title{
  font-size:21px; font-weight:700; margin:24px 0 12px; color: var(--ink);
  counter-increment: subsec;
}
section.subsec > .section-title:not([data-labeled])::before{
  content: counter(sec) "." counter(subsec) ". "; font-weight:700; margin-right:2px; color: var(--ink)
}

p{margin:10px 0; text-align:justify}
hr.sep{border:none; border-top:1px solid var(--rule); margin:24px 0}

/* ---------------- Counters ---------------- */
.roman-italic { list-style: lower-roman; counter-reset: roman-italic; padding-left: 3.8rem }
.roman-italic li { counter-increment: roman-italic }
.roman-italic li::marker { content: "(" counter(roman-italic, lower-roman) ")    "; font-style: italic }

.decimal { list-style: lower-roman; counter-reset: decimal; padding-left: 2.3rem }
.decimal li { counter-increment: decimal }
.decimal li::marker { content: "(" counter(decimal, decimal) ")  " }

/* ---------------- Equation wrapper ---------------- */
equation{display:block; position:relative; text-align:center; margin:14px 0}
equation[data-align="left"] mjx-container[display="true"]{ text-align: left; margin-left: 1em !important; }
section.sec equation::after{
  counter-increment: eq; content: "(" counter(sec) "." counter(eq) ")";
  position:absolute; right:0; top:50%; transform:translateY(-50%); color:var(--muted)
}
section.appendix equation::after{
  counter-increment: eq; content: "(" counter(app, upper-alpha) "." counter(eq) ")";
  position:absolute; right:0; top:50%; transform:translateY(-50%); color:var(--muted)
}
equation[data-numbered="false"]::after{content:none}

/* ---------------- Enunciations ---------------- */
theorem, lemma, corollary, proposition, definition, remark{
  display:block; margin:18px 0; padding:12px 14px; border:1px solid var(--rule);
  border-left-width:3px; border-radius:var(--radius); background:#fff;
  font-style: normal;
}
theorem{border-left-color:var(--theorem)}
proposition{border-left-color:var(--theorem)}
lemma{border-left-color:var(--lemma)}
corollary{border-left-color:var(--cor)}
definition{border-left-color:var(--def)}
remark{border-left-color:var(--rem)}

/* Fallback labels (no-JS) — only when [data-labeled] 없음 */
section.sec theorem:not([data-labeled])::before,
section.sec lemma:not([data-labeled])::before,
section.sec corollary:not([data-labeled])::before,
section.sec proposition:not([data-labeled])::before{
  counter-increment: thm; display:block; font-weight:600; margin-bottom:6px;
}
section.sec theorem:not([data-labeled])::before{content: "Theorem " counter(sec) "." counter(thm) "."}
section.sec lemma:not([data-labeled])::before{content: "Lemma " counter(sec) "." counter(thm) "."}
section.sec corollary:not([data-labeled])::before{content: "Corollary " counter(sec) "." counter(thm) "."}
section.sec proposition:not([data-labeled])::before{content: "Proposition " counter(sec) "." counter(thm) "."}

section.appendix theorem:not([data-labeled])::before,
section.appendix lemma:not([data-labeled])::before,
section.appendix corollary:not([data-labeled])::before,
section.appendix proposition:not([data-labeled])::before{
  counter-increment: thm; display:block; font-weight:600; margin-bottom:6px;
}
section.appendix theorem:not([data-labeled])::before{content: "Theorem " counter(app, upper-alpha) "." counter(thm) "."}
section.appendix lemma:not([data-labeled])::before{content: "Lemma " counter(app, upper-alpha) "." counter(thm) "."}
section.appendix corollary:not([data-labeled])::before{content: "Corollary " counter(app, upper-alpha) "." counter(thm) "."}
section.appendix proposition:not([data-labeled])::before{content: "Proposition " counter(app, upper-alpha) "." counter(thm) "."}

section.sec definition{counter-increment: def}
section.sec definition:not([data-labeled])::before{
  content: "Definition " counter(sec) "." counter(def) ".";
  display:block; font-weight:600; margin-bottom:6px
}
section.sec remark{counter-increment: rem}
section.sec remark:not([data-labeled])::before{
  content: "Remark " counter(sec) "." counter(rem) ".";
  display:block; font-style:italic; margin-bottom:6px
}

section.appendix definition{counter-increment: def}
section.appendix definition:not([data-labeled])::before{
  content: "Definition " counter(app, upper-alpha) "." counter(def) ".";
  display:block; font-weight:600; margin-bottom:6px
}
section.appendix remark{counter-increment: rem}
section.appendix remark:not([data-labeled])::before{
  content: "Remark " counter(app, upper-alpha) "." counter(rem) ".";
  display:block; font-style:italic; margin-bottom:6px
}

/* Footer */
theorem > footer,
definition > footer
{margin-top:8px; padding-top:8px; border-top:1px dashed var(--rule); font-size: 0.84rem}

/* Examples */
details.example{margin-top:8px; padding-top:8px; border-top:1px dashed var(--rule)}
details.example > summary{list-style:none; cursor:pointer; font-style:italic; font-weight:600; color:var(--muted)}
details.example > summary::-webkit-details-marker{display:none}
details.example > summary:empty::before{content:"Example."}
details.example p{font-style: normal}

/* Proofs */
details.proof{margin-top:8px; padding-top:8px; border-top:1px dashed var(--rule)}
details.proof > summary{list-style:none; cursor:pointer; font-style:italic; font-weight:600; color:var(--muted)}
details.proof > summary::-webkit-details-marker{display:none}
details.proof > summary:empty::before{content:"Proof."}
details.proof p{font-style: normal}
details.proof > p:last-of-type::after, details.proof > div p:last-of-type::after{content:"□"; float:right}

proof{display:block; margin:12px 0 14px 1.25em}
proof::before{content:"Proof."; font-style:italic; margin-right:.35em}
proof p{margin: .6em 0; font-style: normal}
proof p:last-of-type::after{content:"□"; float:right}

/* Figures & Tables (fallback prefixes only) */
figure{margin:16px 0; text-align:center}
section.sec figure{counter-increment: fig}
section.appendix figure{counter-increment: fig}
section.sec figure > figcaption:not([data-labeled])::before{
  content:"Figure " counter(sec) "." counter(fig) ". "; font-weight:600
}
section.appendix figure > figcaption:not([data-labeled])::before{
  content:"Figure " counter(app, upper-alpha) "." counter(fig) ". "; font-weight:600
}

table{width:100%; border-collapse:collapse; margin:14px 0}
th,td{border:1px solid var(--rule); padding:6px 8px}
section.sec table{counter-increment: tab}
section.appendix table{counter-increment: tab}
section.sec table > caption:not([data-labeled])::before{
  content:"Table " counter(sec) "." counter(tab) ". "; font-weight:600
}
section.appendix table > caption:not([data-labeled])::before{
  content:"Table " counter(app, upper-alpha) "." counter(tab) ". "; font-weight:600
}
section strong {font-weight: 600}

/* Inserted label nodes */
.block-title{font-weight:600; font-size: 1.14rem; margin-bottom:6px}
.block-subtitle{font-weight:500; font-size: 1.06rem; font-style: italic}
.secno, .ftno{font-weight:700}


/* ===== Responsive TOC ===== */
:root{
  --toc-w: 280px;
  --toc-gap: 24px;
}
@media (min-width: 1100px){
  main{
    display: grid;
    grid-template-columns: 1fr var(--toc-w);
    gap: var(--toc-gap);
    align-items: start;
  }
  main > article{ grid-column: 1; grid-row: 1; }
  main > .toc{ grid-column: 2; grid-row: 1; }
  .toc{ position: sticky; top: 16px; max-height: calc(100vh - 24px); overflow:auto; border-left:1px solid var(--rule); padding-left: 16px; }
  .toc-drawer{ display:none }
}
.toc-inner{ padding: 8px 0 12px }
.toc-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px }
.toc-actions{ display:flex; gap:6px }
.toc-btn{ border:1px solid var(--rule); background:#fff; padding:4px 8px; border-radius: 999px; font-size:12px; cursor:pointer }
.toc-btn:hover{ background: var(--soft) }
.toc-tree{ font-size: .94rem; line-height: 1.5 }
.toc-tree ul{ list-style:none; margin:0; padding:0 }
.toc-tree li{ margin: 2px 0 }
.toc-tree a{ color: var(--ink); text-decoration: none; display: inline-flex; align-items: center; gap:0.1rem; min-width:0 }
.toc-tree a .toc-text{ display:inline-block; max-width: 28ch; white-space: nowrap; overflow: hidden; text-overflow: ellipsis }
.toc a[aria-current="true"]{ background: linear-gradient(90deg, rgba(47,93,169,.12), transparent); border-radius:6px; padding:1px 6px }
.toc-level-1 { margin: 10px 0 12px }
.toc-level-1 > a{ font-weight:700; display:inline-block }
.toc-level-2 { margin: 6px 0 6px }
.toc-level-2 > a{ font-weight:600 }
.toc-level-3 > a{ font-weight:500 }
.toc-items{ margin:4px 0 8px 1rem; padding-left:.9rem; border-left:1px dashed var(--rule); position:relative }
.toc-kind{ display:inline-block; width:0.5rem; height:0.5rem; border-radius:0.25rem; position: relative; left: -0.25rem; align-self:center }
.toc-kind--theorem{ background: var(--theorem) }
.toc-kind--definition{ background: var(--def) }
.toc-kind--lemma{ background: var(--lemma) }
.toc-kind--corollary{ background: var(--cor) }
.toc-kind--proposition{ background: var(--theorem) }
.toc-kind--remark{ background: var(--rem) }
.toc-drawer{
  position: fixed; inset: auto 0 0 0; background:#fff; border-top-left-radius:12px; border-top-right-radius:12px;
  box-shadow: 0 -10px 30px rgba(0,0,0,.18); transform: translateY(100%); transition: transform .28s ease; z-index: 70;
  max-height: 70vh; display: grid; grid-template-rows: auto 1fr auto;
}
#toc-drawer-toggle:checked ~ .toc-drawer{ transform: translateY(0) }
.toc-drawer-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--rule); font-weight:700 }
.toc-tree--drawer{ padding:10px 14px; overflow:auto }
.toc-drawer-actions{ padding:8px 14px; border-top:1px solid var(--rule); display:flex; gap:8px; justify-content:flex-end }
.toc-menu-btn{
  position:absolute; right:12px; top:10px;
  border:1px solid var(--rule); background:#fff; border-radius:8px; padding:6px 8px; cursor:pointer; font-weight:700; z-index:90
}
/* Theorem left bar single */
theorem, lemma, corollary, proposition, definition, remark{ position: relative; overflow: hidden; border-left:0 !important; padding-left: 0.875rem }
theorem::before, lemma::before, corollary::before, proposition::before, definition::before, remark::before{
  content:""; position:absolute; left:0; top:10px; bottom:10px; width:4px; border-radius:8px;
}
theorem::before, proposition::before{ background: var(--theorem) }
lemma::before{ background: var(--lemma) }
corollary::before{ background: var(--cor) }
definition::before{ background: var(--def) }
remark::before{ background: var(--rem) }
